# ゲーム要件定義: 002_harmony_game (ハーモニーゲーム)

## 1. ゲームのコンセプト

### 概要
- 3つの音で構成された和音（ハーモニー）が鳴っており、レベルに応じて1〜3つの音が少しだけズレている。
- 各音に対応するスライダーを動かして正しい音の高さに調整し、**純正律に基づいた**美しいハーモニーを完成させるゲーム。

### ゲームプレイの流れ
1.  **レベル選択**: プレイヤーは最初に「レベル1/2/3」から難易度を選択する。
2.  **問題提示**: ゲームが始まると、和音名（例: C Major）が表示され、少し不協和音になった三和音が自動的に再生され続ける。音は「おとをとめる/さいかい」ボタンでいつでも再生/停止が可能。
3.  **操作**: プレイヤーはズレている音のスライダー（こうおん/ちゅうおん/ていおん）を動かし、音の高さを調整する。
4.  **判定**: 正しいハーモニーになったと思ったら、「これだ！」ボタンを押す。
5.  **結果表示**:
    - **正解/不正解**: 判定結果と共に、正解の周波数範囲(Hz)と解答した周波数(Hz)が数値で表示される。
    - **正解**: スコアが加算され、次の問題に進む。
    - **不正解**: ライフが1つ減る。ライフが残っていれば、同じ問題に再挑戦する。
6.  **ゲームオーバー**: ライフが0になった場合も、まず最後の問題の判定結果が表示される。「けっかをみる」ボタンを押すとリザルト画面に遷移する。

## 2. ゲーム画面・遷移

### 画面遷移
1.  **ゲーム選択画面 (`/index.html`)** → (2) へ
2.  **レベル選択画面 (`/games/002_harmony_game/level_select.html`)** → (3) へ
3.  **ゲーム画面 (`/games/002_harmony_game/index.html`)** → (4) へ (ライフが0になった後)
4.  **リザルト画面 (`/games/002_harmony_game/result.html`)**

### 画面構成 (ゲーム画面)
- **上部**: スコア表示、ライフ表示（❤️x3）
- **中央**: 和音名表示、音の高さ（こうおん/ちゅうおん/ていおん）を示すラベル付きのスライダー
- **下部**: 判定ボタン、フィードバック表示エリア、音の再生/停止ボタン

## 3. ゲームロジック

### レベル設計
- **レベル1**: 三和音のうち、**1音**のスライダーが操作可能。
- **レベル2**: 三和音のうち、**2音**のスライダーが操作可能。
- **レベル3**: 三和音のうち、**3音**のスライダーが操作可能。

### スライダーの仕様
- **調整範囲**: 目標周波数に対して **±50セント** の範囲で調整可能。
- **目盛り**: スライダーのトラックには、音の高さの目安となる目盛りが表示される。
- **ラベル**: 各スライダーには、和音内での相対的な高さを示す「こうおん」「ちゅうおん」「ていおん」のラベルが表示される。

### 判定基準
- **純正律**: 正解判定は、**純正律**の周波数比に基づいて行う。
- **許容範囲（動的変更）**:
    - 初期状態では、目標周波数から **±10セント** のズレまでを正解とする。
    - 10問正解するごとに、許容範囲が **1セント** ずつ狭くなる（最小で **±3セント** まで）。

### 問題の進行と難易度上昇
- **調の追加**:
    - ゲーム開始時は「ハ長調 (C-dur)」の和音のみ出題。
    - 5問正解するごとに、調号 (♯/♭) が1つ多い調が問題の候補に追加される（最大3つまで）。
- **和音の重複排除**:
    - 直近5問で出題された和音は、次の問題で出題されない。
- **音色の追加**:
    - 3問正解するごとに、和音に使用される楽器（音源）の種類が増える（最大3種類）。

### リザルト画面
- **スコア送信**: ゲームオーバー時に、スコアとレベルがAWSバックエンドに送信される。
- **結果表示**:
    - 最終スコアを表示。
    - AWSから取得した全プレイヤーのスコアデータに基づき、スコア分布グラフとトップ5ランキングが表示される。
